/**
 * OWASP Benchmark Project v1.2
 *
 * This file is part of the Open Web Application Security Project (OWASP)
 * Benchmark Project. For details, please see
 * [https://owasp.org/www-project-benchmark/](https://owasp.org/www-project-benchmark/).
 *
 * The OWASP Benchmark is free software: you can redistribute it and/or modify it under the terms
 * of the GNU General Public License as published by the Free Software Foundation, version 2.
 *
 * The OWASP Benchmark is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without
 * even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 *
 * @author Nick Sanidas
 * @created 2015
 */
package org.owasp.benchmark.testcode

import org.apache.commons.codec.binary.Base64
import javax.servlet.annotation.WebServlet
import javax.servlet.http.HttpServlet
import kotlin.Throws
import javax.servlet.ServletException
import java.io.IOException
import javax.servlet.http.HttpServletRequest
import javax.servlet.http.HttpServletResponse
import org.owasp.benchmark.helpers.SeparateClassRequest
import org.owasp.benchmark.testcode.BenchmarkTest02411
import java.lang.ProcessBuilder
import org.owasp.benchmark.testcode.BenchmarkTest02412
import org.owasp.benchmark.testcode.BenchmarkTest02413
import org.owasp.benchmark.testcode.BenchmarkTest02414
import org.owasp.benchmark.testcode.BenchmarkTest02415
import org.owasp.benchmark.testcode.BenchmarkTest02416
import org.owasp.benchmark.testcode.BenchmarkTest02417
import org.owasp.benchmark.testcode.BenchmarkTest02418
import org.owasp.benchmark.testcode.BenchmarkTest02419
import java.lang.StringBuilder
import org.owasp.benchmark.helpers.ThingInterface
import org.owasp.benchmark.testcode.BenchmarkTest02420
import org.owasp.benchmark.testcode.BenchmarkTest02421
import org.owasp.benchmark.testcode.BenchmarkTest02422
import org.owasp.benchmark.testcode.BenchmarkTest02423
import org.owasp.benchmark.testcode.BenchmarkTest02424
import org.owasp.benchmark.testcode.BenchmarkTest02425
import org.owasp.benchmark.testcode.BenchmarkTest02426
import org.owasp.benchmark.testcode.BenchmarkTest02427
import org.owasp.benchmark.testcode.BenchmarkTest02428
import java.lang.Runtime
import org.owasp.benchmark.testcode.BenchmarkTest02429
import org.owasp.benchmark.testcode.BenchmarkTest02430
import org.owasp.benchmark.testcode.BenchmarkTest02431
import org.owasp.benchmark.testcode.BenchmarkTest02432
import java.io.File
import org.owasp.benchmark.testcode.BenchmarkTest02433
import org.owasp.benchmark.testcode.BenchmarkTest02434
import java.security.NoSuchAlgorithmException
import org.owasp.benchmark.testcode.BenchmarkTest02435
import org.owasp.benchmark.testcode.BenchmarkTest02436
import org.owasp.benchmark.testcode.BenchmarkTest02437
import org.owasp.benchmark.testcode.BenchmarkTest02438
import org.owasp.benchmark.testcode.BenchmarkTest02439
import org.owasp.benchmark.testcode.BenchmarkTest02440
import org.owasp.benchmark.testcode.BenchmarkTest02441
import org.owasp.benchmark.testcode.BenchmarkTest02442
import org.owasp.benchmark.testcode.BenchmarkTest02443
import org.owasp.benchmark.testcode.BenchmarkTest02444
import org.owasp.benchmark.testcode.BenchmarkTest02445
import org.owasp.benchmark.testcode.BenchmarkTest02446
import org.owasp.benchmark.testcode.BenchmarkTest02447
import org.owasp.benchmark.testcode.BenchmarkTest02448
import org.owasp.benchmark.testcode.BenchmarkTest02449
import java.sql.CallableStatement
import java.sql.SQLException
import org.owasp.benchmark.testcode.BenchmarkTest02450
import java.sql.PreparedStatement
import org.owasp.benchmark.testcode.BenchmarkTest02451
import org.springframework.dao.DataAccessException
import org.owasp.benchmark.testcode.BenchmarkTest02452
import org.springframework.dao.EmptyResultDataAccessException
import org.owasp.benchmark.testcode.BenchmarkTest02453
import org.owasp.benchmark.testcode.BenchmarkTest02454
import org.owasp.benchmark.testcode.BenchmarkTest02455
import org.owasp.benchmark.testcode.BenchmarkTest02456
import org.owasp.benchmark.testcode.BenchmarkTest02457
import java.io.FileInputStream
import org.owasp.benchmark.testcode.BenchmarkTest02458
import javax.crypto.Cipher
import javax.crypto.SecretKey
import java.security.spec.AlgorithmParameterSpec
import javax.crypto.spec.IvParameterSpec
import java.io.FileWriter
import javax.crypto.NoSuchPaddingException
import javax.crypto.IllegalBlockSizeException
import javax.crypto.BadPaddingException
import java.security.InvalidAlgorithmParameterException
import org.owasp.benchmark.testcode.BenchmarkTest02459
import javax.crypto.spec.GCMParameterSpec
import org.owasp.benchmark.testcode.BenchmarkTest02460
import org.owasp.benchmark.testcode.BenchmarkTest02461
import org.owasp.benchmark.testcode.BenchmarkTest02462
import org.owasp.benchmark.testcode.BenchmarkTest02463
import org.owasp.benchmark.testcode.BenchmarkTest02464
import org.owasp.benchmark.testcode.BenchmarkTest02465
import org.owasp.benchmark.testcode.BenchmarkTest02466
import org.owasp.benchmark.testcode.BenchmarkTest02467
import org.owasp.benchmark.testcode.BenchmarkTest02468
import java.io.FileOutputStream
import org.owasp.benchmark.testcode.BenchmarkTest02469
import org.owasp.benchmark.testcode.BenchmarkTest02470
import org.owasp.benchmark.testcode.BenchmarkTest02471
import org.owasp.benchmark.testcode.BenchmarkTest02472
import org.owasp.benchmark.helpers.LDAPManager
import org.owasp.benchmark.helpers.ThingFactory
import javax.naming.directory.SearchControls
import javax.naming.directory.DirContext
import javax.naming.directory.InitialDirContext
import javax.naming.NamingEnumeration
import javax.naming.directory.SearchResult
import javax.naming.NamingException
import org.owasp.benchmark.testcode.BenchmarkTest02473
import org.owasp.benchmark.testcode.BenchmarkTest02474
import java.security.MessageDigest
import org.owasp.benchmark.testcode.BenchmarkTest02475
import org.owasp.benchmark.testcode.BenchmarkTest02476
import org.owasp.benchmark.testcode.BenchmarkTest02477
import org.owasp.benchmark.testcode.BenchmarkTest02478
import org.owasp.benchmark.testcode.BenchmarkTest02479
import org.owasp.benchmark.testcode.BenchmarkTest02480
import org.owasp.benchmark.testcode.BenchmarkTest02481
import org.owasp.benchmark.testcode.BenchmarkTest02482
import org.owasp.benchmark.testcode.BenchmarkTest02483
import org.owasp.benchmark.testcode.BenchmarkTest02484
import org.owasp.benchmark.testcode.BenchmarkTest02485
import org.owasp.benchmark.testcode.BenchmarkTest02486
import org.owasp.benchmark.testcode.BenchmarkTest02487
import org.owasp.benchmark.testcode.BenchmarkTest02488
import org.owasp.benchmark.testcode.BenchmarkTest02489
import org.owasp.benchmark.testcode.BenchmarkTest02490
import org.owasp.benchmark.testcode.BenchmarkTest02491
import org.owasp.benchmark.testcode.BenchmarkTest02492
import org.owasp.benchmark.testcode.BenchmarkTest02493
import org.owasp.benchmark.testcode.BenchmarkTest02494
import org.owasp.benchmark.testcode.BenchmarkTest02495
import org.owasp.benchmark.testcode.BenchmarkTest02496
import org.owasp.benchmark.testcode.BenchmarkTest02497
import org.owasp.benchmark.testcode.BenchmarkTest02498
import org.owasp.benchmark.testcode.BenchmarkTest02499
import org.owasp.benchmark.testcode.BenchmarkTest02500
import org.owasp.benchmark.testcode.BenchmarkTest02501
import org.owasp.benchmark.testcode.BenchmarkTest02502
import org.owasp.benchmark.testcode.BenchmarkTest02503
import org.owasp.benchmark.testcode.BenchmarkTest02504
import org.owasp.benchmark.testcode.BenchmarkTest02505
import org.owasp.benchmark.testcode.BenchmarkTest02506
import org.owasp.benchmark.testcode.BenchmarkTest02507
import org.owasp.benchmark.testcode.BenchmarkTest02508
import org.owasp.benchmark.testcode.BenchmarkTest02509
import org.owasp.benchmark.testcode.BenchmarkTest02510
import org.owasp.benchmark.testcode.BenchmarkTest02511
import org.owasp.benchmark.testcode.BenchmarkTest02512
import org.owasp.benchmark.testcode.BenchmarkTest02513
import org.owasp.benchmark.testcode.BenchmarkTest02514
import org.owasp.benchmark.testcode.BenchmarkTest02515
import org.owasp.benchmark.testcode.BenchmarkTest02516
import org.owasp.benchmark.testcode.BenchmarkTest02517
import org.owasp.benchmark.testcode.BenchmarkTest02518
import org.owasp.benchmark.testcode.BenchmarkTest02519
import org.owasp.benchmark.testcode.BenchmarkTest02520
import org.owasp.benchmark.testcode.BenchmarkTest02521
import org.owasp.benchmark.testcode.BenchmarkTest02522
import org.owasp.benchmark.testcode.BenchmarkTest02523
import org.owasp.benchmark.testcode.BenchmarkTest02524
import org.owasp.benchmark.testcode.BenchmarkTest02525
import org.owasp.benchmark.testcode.BenchmarkTest02526
import org.owasp.benchmark.testcode.BenchmarkTest02527
import org.owasp.benchmark.testcode.BenchmarkTest02528
import org.owasp.benchmark.testcode.BenchmarkTest02529
import org.owasp.benchmark.testcode.BenchmarkTest02530
import org.owasp.benchmark.testcode.BenchmarkTest02531
import org.owasp.benchmark.testcode.BenchmarkTest02532
import org.owasp.benchmark.testcode.BenchmarkTest02533
import org.owasp.benchmark.testcode.BenchmarkTest02534
import org.owasp.benchmark.testcode.BenchmarkTest02535
import org.owasp.benchmark.testcode.BenchmarkTest02536
import org.owasp.benchmark.testcode.BenchmarkTest02537
import org.owasp.benchmark.testcode.BenchmarkTest02538
import org.owasp.benchmark.testcode.BenchmarkTest02539
import org.springframework.jdbc.support.rowset.SqlRowSet
import org.owasp.benchmark.testcode.BenchmarkTest02540
import org.owasp.benchmark.testcode.BenchmarkTest02541
import org.owasp.benchmark.testcode.BenchmarkTest02542
import org.owasp.benchmark.testcode.BenchmarkTest02543
import org.owasp.benchmark.testcode.BenchmarkTest02544
import org.owasp.benchmark.testcode.BenchmarkTest02545
import org.owasp.benchmark.testcode.BenchmarkTest02546
import org.owasp.benchmark.testcode.BenchmarkTest02547
import org.owasp.benchmark.testcode.BenchmarkTest02548
import org.owasp.benchmark.testcode.BenchmarkTest02549
import org.owasp.benchmark.testcode.BenchmarkTest02550
import java.util.*
import javax.servlet.http.Cookie

@WebServlet(value = ["/weakrand-05/BenchmarkTest02503"])
class BenchmarkTest02503 : HttpServlet() {
    @Throws(ServletException::class, IOException::class)
    public override fun doGet(request: HttpServletRequest, response: HttpServletResponse) {
        doPost(request, response)
    }

    @Throws(ServletException::class, IOException::class)
    public override fun doPost(request: HttpServletRequest, response: HttpServletResponse) {
        response.contentType = "text/html;charset=UTF-8"
        val values = request.getParameterValues("BenchmarkTest02503")
        val param: String
        param = if (values != null && values.size > 0) values[0] else ""
        val bar = doSomething(request, param)
        val r = Random().nextInt()
        val rememberMeKey = Integer.toString(r)
        var user = "Ingrid"
        val fullClassName = this.javaClass.name
        val testCaseNumber = fullClassName.substring(fullClassName.lastIndexOf('.') + 1 + "BenchmarkTest".length)
        user += testCaseNumber
        val cookieName = "rememberMe$testCaseNumber"
        var foundUser = false
        val cookies = request.cookies
        if (cookies != null) {
            var i = 0
            while (!foundUser && i < cookies.size) {
                val cookie = cookies[i]
                if (cookieName == cookie.name) {
                    if (cookie.value == request.session.getAttribute(cookieName)) {
                        foundUser = true
                    }
                }
                i++
            }
        }
        if (foundUser) {
            response.writer.println(
                "Welcome back: $user<br/>"
            )
        } else {
            val rememberMe = Cookie(cookieName, rememberMeKey)
            rememberMe.secure = true
            rememberMe.isHttpOnly = true
            rememberMe.path = request.requestURI // i.e., set path to JUST this servlet 
            // e.g., /benchmark/sql-01/BenchmarkTest01001
            request.session.setAttribute(cookieName, rememberMeKey)
            response.addCookie(rememberMe)
            response.writer.println(
                user + " has been remembered with cookie: " + rememberMe.name
                        + " whose value is: " + rememberMe.value + "<br/>"
            )
        }
        response.writer.println(
            "Weak Randomness Test java.util.Random.nextInt() executed"
        )
    } // end doPost

    companion object {
        private const val serialVersionUID = 1L

        @Throws(ServletException::class, IOException::class)
        private fun doSomething(request: HttpServletRequest, param: String): String {

            // Chain a bunch of propagators in sequence
            val b70407 = StringBuilder(
                param //assign
            ) // stick in stringbuilder
            b70407.append(" SafeStuff") // append some safe content
            b70407.replace(b70407.length - "Chars".length, b70407.length, "Chars") //replace some of the end content
            val map70407 =
                HashMap<String, Any>()
            map70407["key70407"] = b70407.toString() // put in a collection
            val c70407 = map70407["key70407"] as String? // get it back out
            val d70407 = c70407!!.substring(0, c70407.length - 1) // extract most of it
            val e70407 = String(
                Base64.decodeBase64(
                    Base64.encodeBase64(d70407.toByteArray())
                )
            ) // B64 encode and decode it
            val f70407 = e70407.split(" ".toRegex()).toTypedArray()[0] // split it on a space
            val thing = ThingFactory.createThing()
            val g70407 = "barbarians_at_the_gate" // This is static so this whole flow is 'safe'
            return thing.doSomething(g70407) // reflection
        }
    }
}